<div class="p-8 bg-gray-100 min-h-screen">
  <button class="mb-4 text-blue-600 hover:underline" routerLink="/home-staff">
    ‚Üê Back to Requests
  </button>

  <h2 class="text-3xl font-bold text-blue-800 mb-6">
    Document Request Details
  </h2>

  <div *ngIf="loading">Loading...</div>
  <div *ngIf="errorMessage" class="text-red-600">
    {{ errorMessage }}
  </div>

  <div *ngIf="request" class="bg-white p-6 rounded-lg shadow-md space-y-4">
    <p><strong>Request ID:</strong> {{ request.RequestID }}</p>
    <p><strong>Name:</strong> {{ request.name }}</p>
    <p><strong>Status:</strong> {{ request.status }}</p>
    <p>
      <strong>Requested At:</strong>
      {{ request.date_created | date:'medium' }}
    </p>
    <p *ngIf="request.updated_at">
      <strong>Last Updated:</strong>
      {{ request.updated_at | date:'medium' }}
    </p>

    <!-- File Preview -->
    <div *ngIf="request.fileUrls?.length">
      <p><strong>Files:</strong></p>

      <div *ngFor="let file of request.fileUrls" class="mb-4">
        <!-- Clickable link for all file types -->
        <p>
          <a [href]="file" target="_blank" class="text-blue-600 hover:underline">
            Open file
          </a>
        </p>

        <!-- Image Preview -->
        <img *ngIf="isImageUrl(file)"
             [src]="file"
             alt="Document File"
             class="max-w-full border rounded mt-2" />

        <!-- PDF Preview -->
        <iframe *ngIf="isPdfUrl(file)"
                [src]="file"
                class="w-full h-64 border rounded mt-2">
        </iframe>
      </div>

      <p *ngIf="!request.fileUrls?.length" class="text-gray-500">No files attached.</p>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="flex gap-4 mt-6">
      <button
        class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
        (click)="approveRequest()">
        Approve
      </button>

      <button
        class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
        (click)="denyRequest()">
        Deny
      </button>
    </div>
  </div>
</div>

<!-- Deny Modal -->
<div
  *ngIf="showDenyModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"
>
  <div class="bg-white p-6 rounded-lg w-96">
    <h3 class="text-xl font-bold mb-4 text-red-600">Deny Request</h3>
    <p class="mb-2">Select reasons for denial:</p>

    <div class="space-y-2 max-h-64 overflow-y-auto">
      <div *ngFor="let option of denialOptions" class="flex flex-col">
        <label class="flex items-center gap-2">
          <input type="checkbox" [checked]="option.selected" (change)="toggleReason($event, option)" />
          {{ option.label }}
        </label>
        <input
          *ngIf="option.selected"
          type="text"
          placeholder="Add details (optional)"
          class="border p-1 rounded mt-1"
          [(ngModel)]="option.details"
        />
      </div>
    </div>

    <div class="mt-4 flex justify-end gap-2">
      <button
        class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
        (click)="cancelDeny()"
      >
        Cancel
      </button>
      <button
        class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
        (click)="confirmDeny()"
      >
        Deny
      </button>
    </div>
  </div>
</div>
