<!-- request-detail.component.html -->
<div class="rd-page">

  <!-- Header -->
  <div class="rd-header">
    <button class="rd-back-btn" routerLink="/home-staff">
      <span class="rd-back-arrow">â†</span> Back to Requests
    </button>
    <h1 class="rd-title">Request Details</h1>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="rd-loading">
    <div class="rd-spinner"></div>
    <p>Loading request...</p>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="rd-error">
    <span class="rd-error-icon">âš </span> {{ errorMessage }}
  </div>

  <!-- Main Content -->
  <div *ngIf="request" class="rd-content">

    <!-- Info Card -->
    <div class="rd-card rd-info-card">
      <div class="rd-card-header">
        <span class="rd-card-icon">ğŸ“‹</span>
        <h2 class="rd-card-title">Request Information</h2>
        <span class="rd-status-badge rd-status-{{ request.status }}">{{ request.status | titlecase }}</span>
      </div>

      <div class="rd-info-grid">
        <div class="rd-info-item">
          <span class="rd-info-label">Request ID</span>
          <span class="rd-info-value rd-id">#{{ request.RequestID }}</span>
        </div>
        <div class="rd-info-item">
          <span class="rd-info-label">Applicant Name</span>
          <span class="rd-info-value">{{ request.name }}</span>
        </div>
        <div class="rd-info-item">
          <span class="rd-info-label">Document Type</span>
          <span class="rd-info-value">{{ request.document_type || 'â€”' }}</span>
        </div>
        <div class="rd-info-item">
          <span class="rd-info-label">Requested At</span>
          <span class="rd-info-value">{{ request.date_created | date:'MMM d, y Â· h:mm a' }}</span>
        </div>
        <div class="rd-info-item" *ngIf="request.updated_at">
          <span class="rd-info-label">Last Updated</span>
          <span class="rd-info-value">{{ request.updated_at | date:'MMM d, y Â· h:mm a' }}</span>
        </div>
      </div>
    </div>

    <!-- Files Card -->
    <div class="rd-card rd-files-card">
      <div class="rd-card-header">
        <span class="rd-card-icon">ğŸ“</span>
        <h2 class="rd-card-title">Attached Documents</h2>
        <span class="rd-file-count" *ngIf="request.fileUrls?.length">{{ request.fileUrls.length }} file(s)</span>
      </div>

      <div *ngIf="request.fileUrls?.length; else noFiles" class="rd-files-grid">
        <div *ngFor="let file of request.fileUrls; let i = index" class="rd-file-item">

          <!-- Image Thumbnail -->
          <div *ngIf="file.match(/\.(png|jpe?g)$/i)" class="rd-thumbnail-wrap" (click)="openLightbox(file)">
            <img [src]="file" alt="Document {{ i + 1 }}" class="rd-thumbnail" />
            <div class="rd-thumbnail-overlay">
              <span class="rd-zoom-icon">ğŸ”</span>
              <span>Click to view</span>
            </div>
          </div>

          <!-- PDF Preview -->
          <div *ngIf="file.endsWith('.pdf')" class="rd-pdf-wrap">
            <iframe [src]="file" class="rd-pdf-frame"></iframe>
          </div>

          <div class="rd-file-footer">
            <span class="rd-file-label">Document {{ i + 1 }}</span>
            <a [href]="file" target="_blank" class="rd-open-link">â†— Open original</a>
          </div>
        </div>
      </div>

      <ng-template #noFiles>
        <div class="rd-no-files">
          <span class="rd-no-files-icon">ğŸ“­</span>
          <p>No files attached to this request.</p>
        </div>
      </ng-template>
    </div>

    <!-- Action Buttons -->
    <div class="rd-actions">
      <button class="rd-btn rd-btn-process" (click)="processRequest()">
        <span>âœ“</span> Process Request
      </button>
      <button class="rd-btn rd-btn-deny" (click)="denyRequest()">
        <span>âœ•</span> Deny Request
      </button>
    </div>

  </div>
</div>

<!-- â”€â”€ Lightbox â”€â”€ -->
<div *ngIf="lightboxImage" class="rd-lightbox-overlay" (click)="closeLightbox()">
  <div class="rd-lightbox-box" (click)="$event.stopPropagation()">
    <button class="rd-lightbox-close" (click)="closeLightbox()">âœ•</button>
    <img [src]="lightboxImage" alt="Full Preview" class="rd-lightbox-img" />
    <a [href]="lightboxImage" target="_blank" class="rd-lightbox-link">â†— Open original</a>
  </div>
</div>

<!-- â”€â”€ Deny Modal â”€â”€ -->
<div *ngIf="showDenyModal" class="rd-modal-overlay" (click)="cancelDeny()">
  <div class="rd-modal-box" (click)="$event.stopPropagation()">
    <div class="rd-modal-header">
      <h3 class="rd-modal-title">Deny Request</h3>
      <p class="rd-modal-subtitle">Select the reason(s) for denial</p>
    </div>

    <div class="rd-denial-options">
      <div *ngFor="let option of denialOptions" class="rd-denial-item">
        <label class="rd-denial-label">
          <input type="checkbox" [checked]="option.selected" (change)="toggleReason($event, option)" class="rd-checkbox" />
          <span class="rd-denial-text">{{ option.label }}</span>
        </label>
        <div *ngIf="option.selected" class="rd-denial-detail">
          <textarea
            [(ngModel)]="option.details"
            placeholder="Provide details (optional)"
            class="rd-textarea"
            rows="2"
          ></textarea>
        </div>
      </div>
    </div>

    <div class="rd-modal-actions">
      <button class="rd-btn rd-btn-cancel" (click)="cancelDeny()">Cancel</button>
      <button class="rd-btn rd-btn-confirm-deny" (click)="confirmDeny()">Confirm Denial</button>
    </div>
  </div>
</div>